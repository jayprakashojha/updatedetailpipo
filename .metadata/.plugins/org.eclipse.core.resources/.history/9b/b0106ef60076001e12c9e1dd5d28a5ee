package com.example.demo;

import java.io.IOException;
import java.sql.Blob;
import java.util.List;

import org.apache.catalina.User;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.ui.ModelMap;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;
import org.springframework.web.servlet.view.RedirectView;


@RestController
public class Controller<FileStorageService> {
	@Autowired
	  FilesStorageService storageService;
	
	@Autowired
	private ProductService service;
	
	@Autowired
	private Interface2Impl servi;
	
	 	@PostMapping("/registerdata")
	public String register(@RequestParam String name,@RequestParam String middle,@RequestParam String last,@RequestParam String phone, @RequestParam String dob,@RequestParam String email,@RequestParam String category,
			@RequestParam String spab,@RequestParam String kd,@RequestParam String state,
			@RequestParam String district,@RequestParam String address,@RequestParam String city,
			@RequestParam Integer pincode,@RequestParam String documenttype,@RequestParam int dn,@RequestParam Blob file)
	{
		Product p=new Product();
		p.setName(name);
	    p.setMiddle(middle);
	    p.setLast(last);
	    p.setPhone(phone);
	    p.setDob(dob);
	    p.setEmail(email);
	    p.setCategory(category);
	    p.setSpab(spab);
	    p.setKd(kd);
	    p.setState(state);
	    p.setDistrict(district);
	    p.setAddress(address);
	    p.setCity(city);
	    p.setPincode(pincode);
	    p.setDocumenttype(documenttype);
	    p.setDn(dn);
	    p.setImageData(file);
	    
		service.addData(p);
		
		System.out.println(dn);
		
		return "sucessfully";
	}
	@RequestMapping({"/showAction"})
	public ResponseEntity<?> showaction(ModelMap model)
	{
		String str="select id,name,phone from registrationtbl";
		List<Bean> dataList=servi.findBySqlQuery(str);
		String tableRowStr = "<table id=\"tablename\" class=\"table table-striped table-bordered table-sm\" style=\"width: 50%; font-size: fs;\"><thead><tr><th>ID</th><th>NAME</th></tr></thead><tbody id=\"dbDateSendOtpTableBody\">";
		for(int i=0;i<dataList.size();i++)
		{
		Bean b=dataList.get(i);
		tableRowStr = tableRowStr + "<tr> <td><a href=getId>" + b.getId() + "</a></td> <td>" + b.getName() + "</td></tr>";
		  }
		 tableRowStr = tableRowStr + "</tbody></table>";
		return ResponseEntity.ok(tableRowStr);
	}
	@PostMapping("/users/save")
    public RedirectView saveUser(User user,
            @RequestParam("image") MultipartFile multipartFile) throws IOException {
         
        String fileName = StringUtils.cleanPath(multipartFile.getOriginalFilename());
        user.setPhotos(fileName);
         
        User savedUser = repo.save(user);
 
        String uploadDir = "user-photos/" + savedUser.getId();
 
        FileUploadUtil.saveFile(uploadDir, fileName, multipartFile);
         
        return new RedirectView("/users", true);
    }

	
}
