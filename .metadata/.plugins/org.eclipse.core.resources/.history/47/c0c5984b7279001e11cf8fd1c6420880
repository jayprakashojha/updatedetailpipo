package com.example.demo;

import java.io.IOException;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Controller;
import org.springframework.ui.ModelMap;
import org.springframework.util.StringUtils;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.multipart.MultipartFile;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;
@Controller
@RequestMapping("/")
public class Controllermain {

	@Autowired
	private Interface1 service;
	@Autowired
	private Interface2Impl servi;
	
	@RequestMapping("/index")
	public String index()
	{
		return "index";
	}
	
	@PostMapping("/upload")
	public String uploadFile(@RequestParam String fname,@RequestParam String middle,@RequestParam String last,
			@RequestParam String phone,
			@RequestParam String dob,
			@RequestParam String email,
			@RequestParam String category,
			@RequestParam String spab,
			@RequestParam String kd,
			@RequestParam String state,
			@RequestParam String district,
			@RequestParam String address,
			@RequestParam String city,
			@RequestParam int pincode,
			@RequestParam String documenttype,
			@RequestParam int dn,
	
			
			@RequestParam("document") MultipartFile multipartfile,
			RedirectAttributes ra) throws IOException
	{
		String fileName=StringUtils.cleanPath(multipartfile.getOriginalFilename());
		Product document=new Product();
		document.setFname(fname);
		document.setMiddle(middle);
		document.setLast(last);
		document.setPhone(phone);
		document.setDob(dob);
		document.setEmail(email);
		document.setCategory(category);
		document.setSpab(spab);
		document.setKd(kd);
		document.setState(state);
		document.setDistrict(district);
		document.setAddress(address);
		document.setCity(city);
		document.setPincode(pincode);
		document.setDocumenttype(documenttype);
		document.setDn(dn);
		
		
		document.setPhoto(multipartfile.getBytes());
		document.setPhotoname(fileName);
		
		
		service.save(document);
		
		ra.addFlashAttribute("message1", "the file has been upload sucessfully");
		return "index";
	}
	@RequestMapping({"/showAction"})
	public ResponseEntity<?> showaction(ModelMap model)
	{
		String str="select id,fname,phone,photo from updatedetail";
		List<Bean> dataList=servi.findBySqlQuery(str);
		String tableRowStr = "<table id=\"tablename\" class=\"table table-striped table-bordered table-sm\" style=\"width: 50%; font-size: fs;\"><thead><tr><th>ID</th><th>NAME</th><th>Phone</th><th>photo</th></tr></thead><tbody id=\"dbDateSendOtpTableBody\">";
		for(int i=0;i<dataList.size();i++)
		{
		Bean b=dataList.get(i);
		tableRowStr = tableRowStr + "<tr> <td><a href=getId>" + b.getId() + "</a></td> <td>" + b.getFname() + "</td><td>" + b.getPhone() + "</td><td>" + b.getPhoto() + "</td></tr>";
		  }
		 tableRowStr = tableRowStr + "</tbody></table>";
		return ResponseEntity.ok(tableRowStr);
	}
	
}
